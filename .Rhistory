filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(str_split(paste0(animals, collapse = ';'), ';')),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, sep =';', collapse = ';'))
stations.df[1,]$animals2
stations.df[1,]$animals
stations.df[1,]$animals %>% paste0(';')
stations.df[1,]$animals %>% paste(';')
stations.df[1,]$animals %>% paste(sep = ';')
stations.df[1,]$animals %>% paste(collapse = ';')
stations.df[1,]$animals %>% unlist %>% paste(collapse = ';')
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(str_split(paste0(animals, collapse = ';'), ';') %>% unlist),
localAnimals = paste0(unique(str_split(localAnimals, ';') %>% unlist), collapse = ';'),
species = paste0(unique(str_split(species, ';') %>% unlist), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, sep =';', collapse = ';'))
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(str_split(paste(animals, ';'), ';')),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, sep =';', collapse = ';'))
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(unlist(str_split(paste(animals, ';')), ';')),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, sep =';', collapse = ';'))
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(unlist(str_split(paste(animals, ';'), ';'))),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, sep =';', collapse = ';'))
View(stations.df)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(unlist(str_split(paste(animals, ';'), ';'))),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, collapse = ';'))
unlist
?unlist
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = unique(unlist(str_split(paste(animals, ';'), ';'), F)),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, collapse = ';'))
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(paste(animals, ';'), ';'), F)), collapse = ';'),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = length(animals),
nSpecies = str_split(species, ";") %>% length,
animals2 = paste0(animals, collapse = ';'))
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(paste(animals, ';'), ';'), F)), collapse = ';'),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = str_split(animals, ";") %>% length
nSpecies = str_split(species, ";") %>% length)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(paste(animals, ';'), ';'), F)), collapse = ';'),
localAnimals = paste0(unique(str_split(localAnimals, ';')), collapse = ';'),
species = paste0(unique(str_split(species, ';')), collapse = ';'),
nAnimals = str_split(animals, ";") %>% length,
nSpecies = str_split(species, ";") %>% length)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(paste(animals, ';'), ';'), F)), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'), F)), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'), F)), collapse = ';'),
nAnimals = str_split(animals, ";") %>% length,
nSpecies = str_split(species, ";") %>% length)
stations.df[1,]$species
stations.df[1,]$species %>% str_split(';')
stations.df[1,]$species %>% str_split(';') %>% length
stations.df[1,]$species[1] %>% str_split(';') %>% length
stations.df[1,]$species %>% unlist %>% str_split(';') %>% length
stations.df[1,]$species[[1]] %>% str_split(';') %>% length
stations.df[1,]$species %>% str_split(';')[[1]] %>% length
stations.df[1,]$species %>% str_split(';')[1] %>% length
stations.df[1,]$species %>% str_split(';') %>% unlist %>% length
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(paste(animals, ';'), ';'), F)), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'), F)), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'), F)), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(animals, ';'), F)), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'), F)), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'), F)), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(animals, ';'), T)), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'), F)), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'), F)), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length)
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(animals, ';'))), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'))), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'))), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length)
str_split
?str_split
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(animals, ';'))), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'))), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'))), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length) %>%
filter(!is.na(lat), !is.na(lon))
stations.df %>% write.csv(paste0(dashboard.dir, 'stations.csv'), row.names = F)
names(stations.df)
?separate
?separate_rows
stations.by.recv <- stations.df %>% select(id, stationDeps) %>%
separate_rows(stationDeps, ";")
stations.by.recv <- stations.df %>% select(id, stationDeps) %>%
separate_rows(stationDeps, sep = ";")
View(stations.by.recv)
c('test' = "test")
allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c(stationDeps = recvDeployID)) %>% View
allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c(recvDeployID = stationDeps)) %>% View
allTracks.df <- allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("recvDeployID" = stationDeps)) %>% View
allTracks.df <- allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("recvDeployID" = "stationDeps")) %>% View
allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("recvDeployID" = "stationDeps")) %>% View
allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("stationDeps" = "recvDeployID")) %>% View
stations.by.recv <- stations.df %>% select(id, stationDeps) %>%
separate_rows(stationDeps, sep = ";") %>%
mutate(recvDeployID = as.numeric(stationDeps)) %>%
select(-stationDeps)
stations.by.recv <- stations.df %>% select(id, stationDeps) %>%
separate_rows(stationDeps, sep = ";") %>%
mutate(recvDeployID = as.numeric(stationDeps)) %>%
select(stationID, recvDeployID)
stations.by.recv <- stations.df %>% select(id, stationDeps) %>%
separate_rows(stationDeps, sep = ";") %>%
mutate(recvDeployID = as.numeric(stationDeps)) %>%
select(stationID = id, recvDeployID)
allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("recvDeployID")) %>% View
View(allTracks.df)
allTracks.df <- allTracks.df.raw %>%
rename(deployID = tagDeployId, lat = latitude, lon = longitude) %>%
left_join(recvDeps, by = c('lat','lon')) %>%
left_join(stations.by.recv, by = c("recvDeployID")) %>%
group_by(deployID) %>%
arrange(end_s) %>%
mutate(lat1 = lag(lat),
lon1 = lag(lon),
lat2 = lat,
lon2 = lon,
recv1 = lag(stationID),
recv2 = stationID,
recvProj1 = lag(projID),
recvProj2 = projID,
ts1 = lag(end_s),
ts2 = begin_s,
route = ifelse(recv1 < recv2, paste(recv1, recv2, sep = '.'), paste(recv2, recv1, sep = '.')),
dir = ifelse(recv1 < recv2, 1, -1)
#   route = ifelse(lat1 < lat2, paste(lat1, lon1, lat2, lon2, sep = ','),  paste(lat2, lon2, lat1, lon1, sep = ','))
#         route = as.integer(as.factor(route))
) %>%
dplyr::select(-projID) %>%
filter(!is.na(route),
recv1!=recv2) %>%
left_join(dplyr::select(tagDeps, deployID, projID, species = speciesID, freq), by = 'deployID') %>%
filter(!is.na(projID) & !is.na(species)) %>%
left_join(antDeps2.df, by = 'recvDeployID') %>%
mutate(freq = as.character(ifelse(is.na(freq.x), freq.y, freq.x))) %>%
group_by(route) %>%
summarise(animal = paste((deployID), collapse=','),
species = paste((species), collapse=','),
type = "LineString",
frequency = paste(freq, collapse=','),#Mode(freq, na.rm = T),
project = paste(projID, collapse=','),
recv1 = recv1[1],
recv2 = recv2[1],
lon1 = lon1[1],
lat1 = lat1[1],
lon2 = lon2[1],
lat2 = lat2[1],
recvProjs = paste(c(recvProj1[1], recvProj2[1]), collapse=','),
tsStart = paste(ts1, collapse=','),
tsEnd = paste(ts2, collapse=','),
dtStart = paste(as.Date(as.POSIXct(ts1, origin = '1970-01-01')), collapse=','),
#      dtStart = (as.Date(as.POSIXct(min(ts1, na.rm = T), origin = '1970-01-01'))),
#      dtEnd = (as.Date(as.POSIXct(max(ts2, na.rm = T), origin = '1970-01-01'))))
dtEnd = paste(as.Date(as.POSIXct(ts2, origin = '1970-01-01')), collapse=','),
dist = distHaversine(c(lon1, lat1), c(lon2, lat2)),
dir = paste(dir, collapse=','))
View(allTracks.df)
allTracks.df %>%  write.csv(paste0(dashboard.dir,'siteTrans_real2.csv'), row.names = F)
allTracks.df %>% select(recv1, recv2)
allTracks.df %>% select(recv1, recv2) %>% unlist
allTracks.df %>% select(recv1, recv2) %>% unlist %>% unique
testUnique1 <- allTracks.df %>% select(recv1, recv2) %>% unlist %>% unique
stations.df
stations.df$id
testUnique1 %in% stations.df$id
which(!testUnique1 %in% stations.df$id)
which(testUnique1 %in% stations.df$id)
which(testUnique1 %in% stations.df$id) %>% length
which((allTracks.df %>% select(recv1, recv2) %>% unlist %>% unique) %in% stations.df$id) %>% length
which(!(allTracks.df %>% select(recv1, recv2) %>% unlist %>% unique) %in% stations.df$id) %>% length
View(stations.df)
stations.df %>% write.csv(paste0(dashboard.dir, 'stations.csv'), row.names = F)
stations.df %>% write.csv(paste0(dashboard.dir, 'stations.csv'), row.names = F)
recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = ifelse(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
View
recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = if_else(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
View
stations.df <- recvDeps.df %>%
ungroup() %>%
mutate(dtStart = as.Date(dtStart),
dtEnd = if_else(is.na(dtEnd), Sys.Date(), as.Date(dtEnd))) %>%
filter(nchar(name) > 0 & !is.na(dtStart)) %>%
group_by(name) %>%
summarise(nDeps = length(unique(id)),
stationDeps = paste0(id, collapse = ';'),
id = id[1],
name = name[1],
lat = median(lat[1], na.rm = T),
lon = median(lon[1], na.rm = T),
frequency = paste0(unique(frequency), collapse = ';'),
projID = paste0(unique(projID), collapse = ';'),
dtStart = as.character(min(dtStart, na.rm = T)),
dtEnd = as.character(max(dtEnd, na.rm = T)),
animals = paste0(unique(unlist(str_split(animals, ';'))), collapse = ';'),
localAnimals = paste0(unique(unlist(str_split(localAnimals, ';'))), collapse = ';'),
species = paste0(unique(unlist(str_split(species, ';'))), collapse = ';'),
nAnimals = str_split(animals, ";") %>% unlist %>% length,
nSpecies = str_split(species, ";") %>% unlist %>% length) %>%
filter(!is.na(lat), !is.na(lon))
stations.df %>% write.csv(paste0(dashboard.dir, 'stations.csv'), row.names = F)
